{% extends 'skeleton.html' %} {% load static %} 
{% block title %}NOFILTR - Instagram Comment Picker{%endblock %} 

{% block head %}
<link rel="stylesheet" href="{% static 'css/index.css' %}" />

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>


    var toggle_speed = "fast";
    let time_remaining = 0;
    let timerHandle;


    // THE FUNCTION THAT GETS A WINNER
    function pick_winner() {
        set_button_message("PICKING...")
        var jqxhr = $.post("http://localhost:8000/pickwinner", $( "#theform" ).serialize(), function (d) {

            response_text = d["response"]
            set_message(response_text)
            set_timer(d["wait"]);

        }).fail(function (jqXHR, textStatus, errorThrown) {
            console.log(errorThrown);
        });
    }



    function initialise_everything(){
        clearInterval(timerHandle);
        time_remaining = 0;
        set_message("Enter the URL and click on \" Pick Winner\"!");        
        $('#pickbutton').attr("disabled", false);
    }



    // ************************SETTING MESSAGE*************************
    function set_message(message){
        $('#messagespara').text(message);
    }

    function set_button_message(message){
        $('#pickbutton').text(message);
    }

    
    

    // ******************** TIMER  FUNCTIONS **************************
    function set_timer(seconds){
        time_remaining = seconds;
        timerHandle = setInterval(count_down_one_sec, 1000);
        $('#pickbutton').attr("disabled", true);
    }
    
    function count_down_one_sec(){
        if(time_remaining > 0){
            time_remaining -= 1;
            set_button_message("Please wait for " + time_remaining + "s...")
        }else{
            clearInterval(timerHandle);
            set_button_message("PICK WINNER!");
            $('#pickbutton').attr("disabled", false);
        }
    }


    // TOGGLE FILTER
    function toggle_filter(){

        if($('#fliter_checkbox').prop('checked') == true){
            $('.filter_section').show(toggle_speed);
        }else{
            $('.filter_section').hide(toggle_speed);
            $('#filterinput').val('');
        }
        
    }



    // TOGGLE MENTIONS
    function toggle_mentions(){

        if($('#mentions_checkbox').prop('checked') == true){
            $('.mentions_section').show(toggle_speed);
        }else{
            $('.mentions_section').hide(toggle_speed);
            $('#mentionsinput').val('');
        }

    }


    // TOGGLE LOGIN
    function toggle_login(){

        if($('#login_checkbox').prop('checked') == true){
            $('.login_field').show(toggle_speed);
        }else{
            $('.login_field').hide(toggle_speed);
            $('.login_field').val('');
        }

    }




    // INITIALISE ALL
    $(document).ready(function(){
        toggle_filter();
        toggle_mentions();
        toggle_login();
        initialise_everything();
    })

    



</script>

{% endblock %} 
{% block body %}
<div id="content">

    <div id="heading-div">
        <div id="logo">
            <img src="{% static 'img/nofiltrlogo.png' %}" />
            <h1>NOFILTR</h1>
        </div>        
    </div>

    
    <div id="formdiv">

        <h2>PICK A RANDOM WINNER FROM INSTAGRAM COMMENTS</h2>
        
        <form id="theform">
            {% csrf_token %}
            
            <!-- post -->
            <span class="form-label">LINK TO THE POST</span>
            <input class="form-text-input" type="text" placeholder="url" name="postlink" />
            

            <!-- filter -->
            <div class="switchdiv">
                <input class="switch" type="checkbox" id="fliter_checkbox" onclick="toggle_filter()"/>
                <label class="form-label" for="fliter_checkbox">COMMENT MUST CONTAIN SPECIFIC WORDS OR HASHTAGS (COMMA SEPERATED)</label>
            </div>
            <input id="filterinput" class="form-text-input filter_section" type="text" placeholder="product, amazing, #noﬁltr, #awesome" name="filter" />
            

            
            <!-- mentions -->
            <div class="switchdiv">
                <input type="checkbox" id="mentions_checkbox" onclick="toggle_mentions()"/>
                <label class="form-label" for="mentions_checkbox">THESE MANY PEOPLE NEED TO BE TAGGED</label>
            </div>
            <input id="mentionsinput" class="form-text-input mentions_section" type="number" placeholder="0" name="mentions" />
            


            <!-- login -->
            <div class="switchdiv">
                <input type="checkbox" id="login_checkbox" onclick="toggle_login()" />
                <label class="form-label" for="login_checkbox">MY ACCOUNT IS PRIVATE</label>
            </div>
            <input class="form-text-input login_field" type="text" placeholder="instagram username" name="username" />
            <input class="form-text-input login_field" type="password" placeholder="instagram password" name="password"/>
        


            <!-- SUBMIT -->
            <button id="pickbutton" type="button" style="width: 100%" onclick="pick_winner()">PICK A WINNER</button>
            
        </form>
    </div>
    
    <div id="messagesdiv">
        <p id="messagespara">
            picking a random winner....
        </p>
    </div>
    
</div>
{% endblock %}
